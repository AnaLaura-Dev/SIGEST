<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gerenciamento de Estágios- Intituição</title>
  <link rel="stylesheet" href="/css/relatorioAlunos.css">
</head>
 
    <body>
        <header>
    <nav>
      <div class="logo">
        <img src="/imagens/logosigest.gif">
      </div>
      <div class="menu">
         <a href="Instituição/inicio.html">Inicio</a>
        <a href="Instituição/propostasDeVagas.html">Propostas de Vagas</a>
        <a href="Instituição/Validarestagio.html">Validar Estágio</a>
        <a href="Instituição/desempenhoalunos.html">Desempenhos</a>
           </a>
      </div>
    </nav>
  </header>
  <h2>Relatórios Recebidos</h2>

<table border="1" width="100%">
    <thead>
        <tr>
            <th>Aluno</th>
            <th>Matrícula</th>
            <th>Relatório</th>
            <th>Data</th>
            <th>Status</th>
            <th>Arquivo</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody id="tabela-relatorios"></tbody>
</table>

<script>
// Buscar relatórios daquela instituição
fetch("php/listarRelatoriosInstituicao.php")
    .then(res => res.json())
    .then(lista => {
        const tabela = document.getElementById("tabela-relatorios");

        if (lista.length === 0) {
            tabela.innerHTML = "<tr><td colspan='7'>Nenhum relatório enviado para esta instituição.</td></tr>";
            return;
        }

        lista.forEach(r => {
            const tr = document.createElement("tr");

            tr.innerHTML = `
                <td>${r.nome}</td>
                <td>${r.matricula}</td>
                <td>Relatório ${r.tipo}</td>
                <td>${r.dataEnvio}</td>
                <td>${r.status}</td>
                <td><a href="uploads/${r.caminhoArquivo}" target="_blank">Abrir</a></td>

                <td>
                    <button onclick="atualizarStatus(${r.idRelatorio}, 'APROVADO')">Aprovar</button>
                    <button onclick="atualizarStatus(${r.idRelatorio}, 'REPROVADO')">Reprovar</button>
                </td>
            `;

            tabela.appendChild(tr);
        });
    });

// Função para aprovar ou reprovar
function atualizarStatus(id, novoStatus) {
    fetch("php/atualizarStatusRelatorio.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ idRelatorio: id, status: novoStatus })
    })
    .then(res => res.text())
    .then(msg => {
        alert(msg);
        location.reload();
    });
}
</script>
    </body>
</html>
